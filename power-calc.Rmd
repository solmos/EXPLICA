---
title: "Power Calculation"
description: |
  Power calculation for EXPLICA using fake-data simulations.
author: "Sergio Olmos"
date: "`r Sys.Date()`"
output: distill::distill_article
---

## Introduction

We are interested in comparing the levels of three biomarkers in the different expotype categories. I used simulated data sets to repeatedly fit linear regression models for different data generating scenarios. The power to detect a statistically significant difference was estimated by computing the proportion of models that resulted in at least one significant difference.

The following summary statistics were used for generating the simulated data sets:

| Biomarker    | Units      | Male mean (SD) | Female Mean (SD) | Size  | Reference |
|--------------|------------|----------------|------------------|-------|-----------|
| Homocysteine | micromol/L | 14.6 (6.1)     | 13.1 (4.6)       | 3,025 |           |
| ApoB         | mg/dL      | 113.9 (31.0)   | 107.0 (32.1)     | 1,501 |           |
| hs-CRP       | mg/L       | 3.19 (5.28)    | 3.35 (5.37)      | 5,072 |           |



## Simulated datasets

Simulated data was generated by the following linear model

$$y_i \sim \text{Normal}(\beta_0 + \beta_1 E_{1i} + \beta_2 E_{2i} + \ldots + \beta_k E_{ki}, \sigma^2)$$

```{r}

library(tidyverse)

simExpotypeData <- function(n, k, y_mean, y_sd, max_effect) {

  ## max_effect <- 0.004
  ## y_mean <- 14
  ## y_sd <- 6

  ## browser()

  max_effect_log <- log(max_effect)
  y_mean_log <- log(y_mean)
  y_sd_log <- log(y_sd)

  id <- 1:n

  expotypes <- LETTERS[1:k]
  expotype <- sample(expotypes, size = n, replace = TRUE)
  expotypes_dummy <- map_dfc(expotypes, ~ expotype == .) %>%
    setNames(paste0("expotype", expotypes)) %>%
    mutate(across(.fns = as.integer))


  ## Does this make sense?
  beta0 <- y_mean
  beta1 <- max_effect
  beta_other <- sample(c(0, max_effect / 2, max_effect), size = k - 2)

  betas <- c(beta0, beta1, beta_other)
  names(betas) <- paste0("beta", 0:(k - 1))

  mu_y <- as.matrix(expotypes_dummy) %*% betas %>%
    .[, 1]

  y_log <- rnorm(n, mu_y, sd = y_sd_log)
  y <- exp(y_log)

  df <- bind_cols(id = id, y = y, expotype = expotype, expotypes_dummy)

  df

}

simExpotypeData(
  n = 10,
  k = 4,
  y_mean = 14,
  y_sd = 1,
  max_effect = 2
)

```
